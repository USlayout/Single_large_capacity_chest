# Single Large Capacity Chest Mod - 要件定義

## 1. プロジェクト概要
Minecraft 1.20.1向けの**単一アイテム専用の大容量チェスト**を追加するForge Modを作成します。
一種類のアイテムだけを大量に保管できる特殊なストレージシステムです。

## 2. 基本仕様

### 2.1 チェストの種類

#### 通常仕様
- [ ] **Tier 1 チェスト**: 204,800個
- [ ] **Tier 2 チェスト**: 2,048,000個
- [ ] **Tier 3 チェスト**: 20,480,000個
- [ ] **Tier 4 チェスト**: 204,800,000個
- [ ] **Tier 5 チェスト**: 2,048,000,000個 **(標準で耐爆)**

#### 耐爆仕様
- [ ] **Tier 1 耐爆チェスト**: 204,800個 (爆発で破壊されない)
- [ ] **Tier 2 耐爆チェスト**: 2,048,000個 (爆発で破壊されない)
- [ ] **Tier 3 耐爆チェスト**: 204,800,000個 (爆発で破壊されない)
- [ ] **Tier 4 耐爆チェスト**: 2,048,000,000個 (爆発で破壊されない)

> **注**: 
> - Tier 5は標準で耐爆性能を持つため、耐爆版は存在しない
> - Tier 5は int 型の最大値(2,147,483,647)に近いため、long型での実装を検討
> - 耐爆チェストはクリーパーやTNTの爆発から保護される

### 2.2 機能要件

#### コア機能
- [ ] **単一アイテム専用**: 最初に入れたアイテムの種類のみ保管可能
- [ ] **大容量保存**: 数値で保存(1スロットに数千〜数万個)
- [ ] チェストを右クリックでGUIを開く
- [ ] GUIで現在の保管数を表示(例: 15,234 / 65,536)
- [ ] アイテムの追加と取り出し
  - 左クリック: 1スタック(64個)取り出し
  - Shift+左クリック: 可能な限り取り出し
  - 右クリック: 1個取り出し
  - アイテムをクリック: 手持ちのアイテムを全て投入

#### 保護機能
- [ ] 空の状態でリセット可能(別のアイテムを入れられる)
- [ ] アイテムが入っている状態では他のアイテムを入れられない
- [ ] 何で壊してもチェストを破壊しても中身を保持したまま回収可能
- [ ] **耐爆機能**: 耐爆仕様のチェストは爆発で破壊されない(Tier 5は標準搭載)

#### レッドストーン連携
- [ ] ホッパーとの連携(自動搬入・搬出)
- [ ] コンパレーター出力(保管率に応じた信号強度 0-15)


### 2.3 クラフトレシピ

#### 通常チェスト

##### Tier 1 チェスト (204,800個)
```
[ガラス] [ガラス] [ガラス]
[鉄ブロック] [チェスト] [鉄ブロック]
[ガラス] [ガラス] [ガラス]
```

##### Tier 2 チェスト (2,048,000個)
```
[ガラス] [ガラス] [ガラス]
[金ブロック] [Tier 1 チェスト] [金ブロック]
[ガラス] [ガラス] [ガラス]
```

##### Tier 3 チェスト (20,480,000個)
```
[ガラス] [ガラス] [ガラス]
[ダイヤブロック] [Tier 2 チェスト] [ダイヤブロック]
[ガラス] [ガラス] [ガラス]
```

##### Tier 4 チェスト (204,800,000個)
```
[ガラス] [ガラス] [ガラス]
[エメラルドブロック] [Tier 3 チェスト] [エメラルドブロック]
[ガラス] [ガラス] [ガラス]
```

##### Tier 5 チェスト (2,048,000,000個) - 標準で耐爆
```
[ネザライトインゴット] [ネザースター] [ネザライトインゴット]
[エンダーパール] [Tier 4 チェスト(耐爆でも可)] [エンダーパール]
[ネザライトインゴット] [ネザースター] [ネザライトインゴット]
```

#### 耐爆チェスト

##### Tier 1 耐爆チェスト
```
[黒曜石] [黒曜石] [黒曜石]
[黒曜石] [Tier 1 チェスト] [黒曜石]
[黒曜石] [黒曜石] [黒曜石]
```

##### Tier 2 耐爆チェスト
```
[黒曜石] [黒曜石] [黒曜石]
[黒曜石] [Tier 2 チェスト] [黒曜石]
[黒曜石] [黒曜石] [黒曜石]
```

##### Tier 3 耐爆チェスト
```
[黒曜石] [黒曜石] [黒曜石]
[黒曜石] [Tier 3 チェスト] [黒曜石]
[黒曜石] [黒曜石] [黒曜石]
```

##### Tier 4 耐爆チェスト
```
[黒曜石] [黒曜石] [黒曜石]
[黒曜石] [Tier 4 チェスト] [黒曜石]
[黒曜石] [黒曜石] [黒曜石]
```

> **注**: Tier 5は標準で耐爆のため、耐爆版のクラフトレシピは不要

### 2.4 GUI設計

#### 表示要素
- [ ] **タイトル**: チェストの名前と容量
- [ ] **アイテムアイコン**: 保管中のアイテム(大きく表示)
- [ ] **数量表示**: "1,523,456 / 2,048,000,000" のような形式(3桁カンマ区切り)
- [ ] **プログレスバー**: 保管率を視覚的に表示
- [ ] **取り出しボタン**:
  - "1個取り出し"
  - "1スタック(64個)取り出し"
  - "1,000個取り出し"
  - "10,000個取り出し"
  - "すべて取り出し"
- [ ] **リセットボタン**: 空の時のみ表示

### 2.5 見た目・テクスチャ

#### デザインコンセプト
- [ ] **ガラス風デザイン**: 外から中のアイテムが見える透明感のあるデザイン
- [ ] 保管中のアイテムがチェスト内部に視覚的に表示される
- [ ] 各ティアごとに色分けされたガラス風の外観

#### 通常チェスト - ガラスカラー
- [ ] **Tier 1**: 白色ガラス風(White Stained Glass風)
  - 明るく清潔な見た目
  - 鉄のフレーム
- [ ] **Tier 2**: 黄色ガラス風(Yellow Stained Glass風)
  - 金色に近い黄色
  - 金のフレーム
- [ ] **Tier 3**: 水色ガラス風(Light Blue Stained Glass風)
  - 涼しげな水色
  - ダイヤモンドのフレーム
- [ ] **Tier 4**: 緑色ガラス風(Green/Lime Stained Glass風)
  - 鮮やかな緑色
  - エメラルドのフレーム
- [ ] **Tier 5**: 透明ガラス風(Clear Glass風)
  - 完全に透明
  - ネザライトの暗いフレーム
  - 耐爆機能標準搭載

#### 耐爆チェスト (Tier 1-4)
- [ ] 通常版の色 + **紫色の縁**
  - 紫色(Purple)の黒曜石フレームで囲まれている
  - ガラス部分は通常版と同じ色
  - 紫の縁で耐爆仕様と一目で分かる
- [ ] 例:
  - Tier 1 耐爆: 白ガラス + 紫の縁
  - Tier 2 耐爆: 黄色ガラス + 紫の縁
  - Tier 3 耐爆: 水色ガラス + 紫の縁
  - Tier 4 耐爆: 緑色ガラス + 紫の縁

#### アイテム表示機能
- [ ] チェスト内部に保管中のアイテムを3D表示
  - アイテムが浮いているように見える
- [ ] 空の状態では何も表示されない
- [ ] ガラス越しに中身が見える

#### 共通要素
- [ ] 半透明で中が見える
- [ ] フレームは各ティアの素材感を表現
- [ ] 光を透過する(周囲を照らさない)
- [ ] 耐爆版の紫の縁は発光エフェクト(オプション)

### 2.6 音響効果
- [ ] 開閉時にバニラチェストと同じ音を再生
- [ ] 破壊時ガラスが割れる音

## 3. 技術要件

### 3.1 対応バージョン
- Minecraft: 1.20.1
- Forge: 47.4.10以上
- Java: 17以上

### 3.2 依存関係
- Minecraft Forge のみ(他MODへの依存なし)

### 3.3 データ保存
- [ ] NBTタグで以下を保存:
  - 保管アイテムのID
  - 保管数量(**long型** - int型は約21億が上限のため)
  - チェストのティア(1-5)
  - 耐爆フラグ(boolean)
- [ ] 効率的なデータ圧縮
- [ ] Tier 5の20億個に対応するためlong型を使用

### 3.4 耐爆実装
- [ ] 爆発イベントをキャンセル
- [ ] 耐爆チェストは爆発耐性値を最大に設定
- [ ] Tier 5は常に耐爆として扱う

### 3.5 パフォーマンス
- [ ] 大量のチェストを設置してもパフォーマンス低下を最小限に
- [ ] 数値計算のみなので通常のチェストより軽量

## 4. 追加機能(オプション)

### 4.1 便利機能
- [ ] **クイック投入**: インベントリ内の同じアイテムを一括投入
- [ ] **自動補充**: ホットバーのアイテムが減ったら自動補充
- [ ] **フィルターロック**: 一度アイテムを入れたら、空になってもそのアイテム専用にロック
- [ ] **名前変更**: 金床で名前をつけられる

### 4.2 カスタマイズ
- [ ] コンフィグファイルで各ティアの容量を変更可能
- [ ] クラフトレシピのカスタマイズ
- [ ] GUI の色やレイアウトのカスタマイズ

### 4.3 互換性
- [ ] JEI/REI との連携(レシピ表示)
- [ ] The One Probe との連携(チェスト内容の表示)
- [ ] WAILA/HWYLA との連携

### 4.4 アップグレード機能
- [ ] チェストを設置したままアップグレード可能
- [ ] アップグレードキット(クラフトアイテム)を使用
- [ ] 中身を保持したままティアアップ

## 5. ユーザビリティ

### 5.1 使いやすさ
- [ ] 直感的なGUI
- [ ] 日本語・英語対応
- [ ] ツールチップでの詳細情報表示
  - 保管中のアイテム名と数量
  - チェストのティア
  - 最大容量

### 5.2 ドキュメント
- [ ] README.md(日本語・英語)
- [ ] クラフトレシピ一覧
- [ ] 使い方ガイド
- [ ] トラブルシューティング

## 6. テスト項目
- [ ] 各ティア(1-5)の通常チェストの設置と使用
- [ ] 各ティア(1-4)の耐爆チェストの設置と使用
- [ ] Tier 5の標準耐爆機能の確認
- [ ] 単一アイテム制限の動作確認
- [ ] 超大量のアイテム(100万個以上)の保存と取り出し
- [ ] Tier 5の20億個近い容量のテスト
- [ ] long型での数値オーバーフローチェック
- [ ] 通常チェストと耐爆チェストのクラフトレシピの動作確認
- [ ] **耐爆機能のテスト**:
  - [ ] クリーパーの爆発で破壊されないか
  - [ ] TNTの爆発で破壊されないか
  - [ ] 通常チェストは爆発で破壊されるか
  - [ ] Tier 5は常に耐爆として機能するか
- [ ] ホッパーとの連携
- [ ] シルクタッチでの回収
- [ ] 複数チェスト設置時のパフォーマンス
- [ ] サーバー環境での動作確認
- [ ] 他MODとの競合チェック
- [ ] 大量アイテムのドロップ処理(破壊時)

## 7. リリース計画

### Phase 1: 基本実装(MVP)
- Tier 1チェスト1種類
- 単一アイテム保存機能
- long型での数量管理
- 基本的なGUI(数量表示のみ)
- クラフトレシピ
- アイテムの保存・取り出し

### Phase 2: ティア拡張
- 5種類すべてのチェスト実装(Tier 1-5)
- 耐爆チェスト実装(Tier 1-4)
- Tier 5の標準耐爆機能
- アップグレードシステム
- 改良されたGUI(プログレスバー、複数の取り出しボタン)
- 大量数値の表示最適化(カンマ区切り、K/M/B表記)

### Phase 3: 連携機能
- ホッパー連携
- コンパレーター出力
- The One Probe等の対応

### Phase 4: 便利機能
- クイック投入
- 自動補充
- フィルターロック
- コンフィグ設定

### Phase 5: 最適化・公開
- パフォーマンス最適化
- ドキュメント整備
- テクスチャの最終調整
- CurseForge/Modrinthへの公開

## 8. 既知の課題
- [ ] 現在の警告(ResourceLocationの非推奨API使用)を修正
- [ ] long型の最大値(9,223,372,036,854,775,807)を考慮した設計

## 9. 類似MODとの差別化
- **Applied Energistics 2**: より軽量でシンプル
- **Storage Drawers**: 視覚的にアイテムが見えない分、超大容量
- **Iron Chests**: 単一アイテム専用で桁違いの容量
- **耐爆機能**: 黒曜石で囲むことで爆発から保護(Tier 5は標準搭載)

---

## 変更履歴
- 2025-11-29: 初版作成
- 2025-11-29: 単一アイテム専用チェストに仕様変更
- 2025-11-29: ティアを5段階に変更、容量を大幅増加(204,800〜2,048,000,000個)、long型対応
- 2025-11-29: 耐爆チェスト追加(Tier 1-4は黒曜石でアップグレード、Tier 5は標準で耐爆)
